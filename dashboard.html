<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Astrologer Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdn.pubnub.com/sdk/javascript/pubnub.7.2.0.min.js"></script>

<style>
body{margin:0;font-family:system-ui;background:#f6f6f8;height:100vh;display:flex}

/* SIDEBAR */
.sidebar{
  width:260px;
  background:#fff;
  padding:14px;
  border-right:1px solid #ddd;
}

.sidebar h3{margin-top:0}
.detail{font-size:14px;margin-bottom:6px}

.status{
  margin-top:12px;
  font-size:13px;
  font-weight:600;
}

.online{color:green}
.offline{color:red}

/* CHAT */
.chat{flex:1;display:flex;flex-direction:column}
.chatBody{flex:1;padding:14px;overflow-y:auto}

.msg{
  padding:10px 12px;
  border-radius:12px;
  margin-bottom:8px;
  max-width:80%;
}

.customer{background:#fff}
.me{background:#ffe6d5;margin-left:auto}
.system{background:#fff3cd;font-size:13px}

/* CONTROLS */
.controls{
  display:flex;
  gap:8px;
  padding:12px;
  background:#fff;
}

input{
  flex:1;
  padding:10px;
  border-radius:20px;
  border:1px solid #ccc;
}

button{
  padding:10px 16px;
  border-radius:20px;
  background:#F8CFAF;
  border:none;
  font-weight:700;
}
</style>
</head>

<body>

<div class="sidebar">
  <h3>Astrologer: Gautam</h3>

  <div id="customerDetails">
    <p><strong>Waiting for customer‚Ä¶</strong></p>
  </div>

  <div id="custStatus" class="status offline">‚óè Customer Offline</div>
</div>

<div class="chat">
  <div id="chatBody" class="chatBody"></div>

  <div class="controls">
    <input id="reply" placeholder="Reply‚Ä¶" />
    <button onclick="send()">Send</button>
  </div>
</div>

<script>
/* ================= PUBNUB ================= */
const CHANNEL="astro_gautam_chat";

const pubnub=new PubNub({
  publishKey:"pub-c-a90a128a-4e77-4b6a-bbb3-59d0fb688ddc",
  subscribeKey:"sub-c-1b514e35-fab1-4baf-88f1-6b628ab7e9c2",
  uuid:"Astrologer_Gautam"
});

pubnub.subscribe({channels:[CHANNEL],withPresence:true});

const chatBody=document.getElementById("chatBody");
const detailsBox=document.getElementById("customerDetails");
const statusEl=document.getElementById("custStatus");

/* ================= LISTEN ================= */
pubnub.addListener({
  message:e=>{
    const m=e.message;
    if(m.sender===pubnub.getUUID())return;

    // üßæ CUSTOMER DETAILS MESSAGE
    if(m.text.startsWith("üßæ")){
      renderDetails(m.text);
      return;
    }

    addMsg(`${m.sender}: ${m.text}`,"customer");
  },

  presence:e=>{
    if(e.uuid.startsWith("Customer_")){
      if(e.action==="join"){
        statusEl.textContent="‚óè Customer Online";
        statusEl.className="status online";
      }
      if(e.action==="leave"||e.action==="timeout"){
        statusEl.textContent="‚óè Customer Offline";
        statusEl.className="status offline";
      }
    }
  }
});

/* ================= SEND ================= */
function send(){
  const input=document.getElementById("reply");
  const text=input.value.trim();
  if(!text)return;

  input.value="";
  addMsg("You: "+text,"me");

  pubnub.publish({
    channel:CHANNEL,
    message:{sender:pubnub.getUUID(),text}
  });
}

/* ================= HELPERS ================= */
function addMsg(text,type){
  const d=document.createElement("div");
  d.className="msg "+type;
  d.textContent=text;
  chatBody.appendChild(d);
  chatBody.scrollTop=chatBody.scrollHeight;
}

function renderDetails(text){
  const lines=text.split("\n").slice(1);
  detailsBox.innerHTML="<h4>Customer Details</h4>"+
    lines.map(l=>`<div class="detail">${l}</div>`).join("");
}
</script>

</body>
</html>

</html>
