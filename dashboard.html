<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Astrologer Dashboard â€” Gautam</title>

<script src="https://cdn.pubnub.com/sdk/javascript/pubnub.7.2.0.min.js"></script>

<style>
body{
  margin:0;
  font-family:system-ui, Inter;
  background:#f2f2f2;
  display:flex;
  justify-content:center;
  align-items:center;
  height:100vh;
}
.chat{
  width:520px;
  height:620px;
  background:#fff;
  border-radius:18px;
  box-shadow:0 10px 30px rgba(0,0,0,.15);
  display:flex;
  flex-direction:column;
}
.header{
  padding:14px;
  background:#F8CFAF;
  border-radius:18px 18px 0 0;
  font-weight:700;
}
.messages{
  flex:1;
  padding:14px;
  overflow:auto;
  background:#efe6dc;
}
.bubble{
  padding:10px 14px;
  border-radius:14px;
  margin-bottom:8px;
  max-width:70%;
}
.me{background:#dcf8c6;margin-left:auto;}
.them{background:#fff;}
.input{
  display:flex;
  gap:8px;
  padding:12px;
}
input{
  flex:1;
  padding:10px;
  border-radius:999px;
  border:1px solid #ddd;
}
button{
  padding:10px 16px;
  border-radius:999px;
  border:none;
  background:#fb8b55;
  color:#fff;
  font-weight:700;
  cursor:pointer;
}
</style>
</head>

<body>

<div class="chat">
  <div class="header">Astrologer: Gautam</div>
  <div id="messages" class="messages"></div>
  <div class="input">
    <input id="text" placeholder="Reply to customer">
    <button onclick="send()">Send</button>
  </div>
</div>

<script>
/* CONFIG */
const CHANNEL = "astro-Gautam";

const pubnub = new PubNub({
  publishKey: "pub-c-a90a128a-4e77-4b6a-bbb3-59d0fb688ddc",
  subscribeKey: "sub-c-1b514e35-fab1-4baf-88f1-6b628ab7e9c2",
  uuid: "astro-Gautam"
});

/* Subscribe */
pubnub.subscribe({ channels: [CHANNEL] });

/* Receive messages (IGNORE OWN MESSAGES) */
pubnub.addListener({
  message: e => {
    if (e.publisher === pubnub.getUUID()) return;
    addBubble(e.message.text, "them");
  }
});

function send(){
  const text = document.getElementById("text").value.trim();
  if(!text) return;

  pubnub.publish({
    channel: CHANNEL,
    message: { text }
  });

  addBubble(text, "me");
  document.getElementById("text").value="";
}

function addBubble(text, who){
  const div = document.createElement("div");
  div.className = "bubble " + who;
  div.textContent = text;
  messages.appendChild(div);
  messages.scrollTop = messages.scrollHeight;
}
</script>

  pubnub.addListener({
  message: e => {
    const m = e.message;
    const ch = e.channel;

    // new customer joined
    if(m?.type==="join" && m.astro===ASTRO){
      pubnub.subscribe({channels:[m.session]});
      createSessionUI(m.session, m.customer);
      return;
    }

    // chat message
    if(m?.text){
      addMessage(ch, m.text, m.sender===pubnub.getUUID()?"me":"them");
    }
  }
});


</body>
</html>

